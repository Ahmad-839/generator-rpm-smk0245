<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator RPM - Rencana Pembelajaran Mendalam</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- html2pdf.js for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* --- STYLE DOKUMEN PROFESIONAL (Untuk Preview & Cetak) --- */
        
        /* Simulasi Kertas A4 di Layar */
        .a4-page {
            background: white;
            width: 210mm; /* A4 Width */
            min-height: 297mm; /* A4 Height */
            margin: 0 auto;
            padding: 20mm 20mm; /* Margin Standar 2cm */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            line-height: 1.3;
            color: #000;
            box-sizing: border-box;
        }

        /* Styling Tabel Profesional */
        .doc-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        .doc-table th, .doc-table td {
            border: 1px solid black;
            padding: 6px 8px; /* Padding sel yang pas */
            vertical-align: top;
            text-align: left;
        }
        .doc-table th {
            background-color: #E0E0E0; /* Abu-abu muda untuk header tabel */
            font-weight: bold;
            text-align: center;
        }
        
        /* Header Bagian (I, II, III, dst) */
        .section-title {
            font-weight: bold;
            background-color: #d1d5db; 
            padding: 5px;
            text-align: left;
            margin-top: 10px;
            border: 1px solid black;
            border-bottom: none;
        }

        /* Judul Dokumen Utama */
        .main-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px double black;
            padding-bottom: 10px;
        }
        .main-header h1 {
            font-size: 14pt;
            font-weight: bold;
            margin: 0;
            text-transform: uppercase;
        }
        .main-header h2 {
            font-size: 12pt;
            font-weight: bold;
            margin: 5px 0 0 0;
        }

        /* Tanda Tangan */
        .signature-table {
            width: 100%;
            border: none;
            margin-top: 30px;
            page-break-inside: avoid;
        }
        .signature-table td {
            border: none;
            text-align: center;
            vertical-align: top;
        }
        .ttd-space {
            height: 80px; /* Jarak tanda tangan yang cukup (setara 3-4 enter) */
        }

        /* Link Styling */
        .doc-link {
            color: #0000EE;
            text-decoration: underline;
        }

        /* Responsif untuk layar HP (agar preview tidak terlalu kecil) */
        @media (max-width: 768px) {
            .a4-page {
                width: 100%;
                padding: 10px;
                font-size: 11pt; /* Sedikit lebih kecil di HP */
            }
        }

        /* Mode Cetak/PDF */
        @media print {
            body * {
                visibility: hidden;
            }
            #previewArea, #previewArea * {
                visibility: visible;
            }
            #previewArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 0;
                margin: 0;
            }
            .a4-page {
                box-shadow: none;
                margin: 0;
                width: 100%;
                padding: 0; /* Biarkan browser mengatur margin cetak */
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans text-gray-800">

    <!-- Header App -->
    <header class="bg-blue-800 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fas fa-print text-2xl"></i>
                <h1 class="text-xl font-bold">Generator RPM Pro</h1>
            </div>
            <div class="text-xs md:text-sm bg-blue-900 px-3 py-1 rounded-full">
                Edisi 2025/2026
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 flex flex-col xl:flex-row gap-8">
        
        <!-- KOLOM INPUT (Kiri) -->
        <div class="w-full xl:w-1/3 bg-white rounded-xl shadow-md p-6 h-fit border-t-4 border-blue-600">
            <h2 class="text-lg font-bold text-gray-700 mb-4 pb-2 border-b flex items-center gap-2">
                <i class="fas fa-pen-to-square text-blue-600"></i> Isi Data Perencanaan
            </h2>
            
            <form id="rpmForm" class="space-y-4 text-sm">
                
                <!-- 1. IDENTITAS -->
                <div class="bg-gray-50 p-3 rounded border">
                    <h3 class="font-bold text-blue-700 mb-2">1. Identitas Sekolah</h3>
                    <div class="space-y-2">
                        <div>
                            <label class="block font-medium text-gray-600">Nama Sekolah</label>
                            <input type="text" id="sekolah" class="w-full rounded border-gray-300 p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="SMKN 1 Maju Jaya" required>
                        </div>
                        <div>
                            <label class="block font-medium text-gray-600">Nama Guru</label>
                            <input type="text" id="guru" class="w-full rounded border-gray-300 p-2" required>
                        </div>
                        <div>
                            <label class="block font-medium text-gray-600">NIP Guru <span class="text-gray-400 font-normal">(Opsional)</span></label>
                            <input type="text" id="nipGuru" class="w-full rounded border-gray-300 p-2" placeholder="-">
                        </div>
                        <div>
                            <label class="block font-medium text-gray-600">Mata Pelajaran</label>
                            <input type="text" id="mapel" class="w-full rounded border-gray-300 p-2" required>
                        </div>
                        <div>
                            <label class="block font-medium text-gray-600">Konsentrasi Keahlian</label>
                            <input type="text" id="konsentrasi" class="w-full rounded border-gray-300 p-2" placeholder="Teknik Mesin / -">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                             <div>
                                <label class="block font-medium text-gray-600">Jenjang</label>
                                <select id="jenjang" onchange="updateKelas()" class="w-full rounded border-gray-300 p-2" required>
                                    <option value="">Pilih...</option>
                                    <option value="SD">SD</option>
                                    <option value="SMP">SMP</option>
                                    <option value="SMA">SMA</option>
                                    <option value="SMK">SMK</option>
                                </select>
                            </div>
                             <div>
                                <label class="block font-medium text-gray-600">Kelas</label>
                                <select id="kelas" onchange="updateFase()" class="w-full rounded border-gray-300 p-2" required>
                                    <option value="">-</option>
                                </select>
                            </div>
                        </div>
                         <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block font-medium text-gray-600">Fase</label>
                                <input type="text" id="fase" class="w-full rounded bg-gray-100 border-gray-300 p-2 text-gray-500" readonly>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-600">Semester</label>
                                <select id="semester" class="w-full rounded border-gray-300 p-2">
                                    <option value="Ganjil">Ganjil</option>
                                    <option value="Genap">Genap</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block font-medium text-gray-600">Tahun Pelajaran</label>
                            <input type="text" id="tahunAjar" class="w-full rounded border-gray-300 p-2" value="2025/2026">
                        </div>
                    </div>
                </div>

                <!-- 2. MATERI & WAKTU -->
                <div class="bg-gray-50 p-3 rounded border">
                    <h3 class="font-bold text-blue-700 mb-2">2. Materi & Waktu</h3>
                    <div class="space-y-2">
                        <div>
                            <label class="block font-medium text-gray-600">Materi Pokok</label>
                            <textarea id="materi" rows="2" class="w-full rounded border-gray-300 p-2" placeholder="Contoh: Sistem Persamaan Linear" required></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block font-medium text-gray-600">Jml Pertemuan</label>
                                <input type="number" id="jmlPertemuan" min="1" max="10" value="1" onchange="updatePedagogyInputs()" class="w-full rounded border-gray-300 p-2" required>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-600">Alokasi Waktu</label>
                                <input type="text" id="durasi" class="w-full rounded border-gray-300 p-2" placeholder="2 JP x 45'" required>
                            </div>
                        </div>
                         <div id="pedagogyContainer" class="mt-2 pt-2 border-t border-gray-200">
                            <label class="block font-medium text-blue-600 text-xs mb-1">Model Pembelajaran per Pertemuan:</label>
                            <div id="pedagogyInputs" class="space-y-1"></div>
                        </div>
                    </div>
                </div>

                <!-- 3. TUJUAN (CP/TP) -->
                <div class="bg-gray-50 p-3 rounded border">
                    <h3 class="font-bold text-blue-700 mb-2">3. Tujuan Pembelajaran</h3>
                    <div class="space-y-2">
                        <div>
                            <label class="block font-medium text-gray-600">Capaian Pembelajaran (CP)</label>
                            <textarea id="cp" rows="3" class="w-full rounded border-gray-300 p-2" required></textarea>
                        </div>
                         <div>
                            <label class="block font-medium text-gray-600">Tujuan Pembelajaran (TP)</label>
                            <textarea id="tp" rows="3" class="w-full rounded border-gray-300 p-2" required></textarea>
                        </div>
                        <div>
                            <label class="block font-medium text-gray-600 mb-1">Dimensi Profil Pelajar</label>
                             <div class="grid grid-cols-2 gap-1 text-xs">
                                <label class="flex items-center"><input type="checkbox" name="dimensi" value="Beriman, Bertakwa" class="mr-1">Beriman</label>
                                <label class="flex items-center"><input type="checkbox" name="dimensi" value="Berkebinekaan Global" class="mr-1">Kebinekaan</label>
                                <label class="flex items-center"><input type="checkbox" name="dimensi" value="Gotong Royong" class="mr-1">Gotong Royong</label>
                                <label class="flex items-center"><input type="checkbox" name="dimensi" value="Mandiri" class="mr-1">Mandiri</label>
                                <label class="flex items-center"><input type="checkbox" name="dimensi" value="Bernalar Kritis" class="mr-1">Bernalar Kritis</label>
                                <label class="flex items-center"><input type="checkbox" name="dimensi" value="Kreatif" class="mr-1">Kreatif</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. KEPALA SEKOLAH -->
                <div class="bg-gray-50 p-3 rounded border">
                     <h3 class="font-bold text-blue-700 mb-2">4. Validasi</h3>
                     <div class="space-y-2">
                        <div>
                            <label class="block font-medium text-gray-600">Nama Kepala Sekolah</label>
                            <input type="text" id="kepsek" class="w-full rounded border-gray-300 p-2" required>
                        </div>
                        <div>
                            <label class="block font-medium text-gray-600">NIP Kepsek <span class="text-gray-400 font-normal">(Opsional)</span></label>
                            <input type="text" id="nipKepsek" class="w-full rounded border-gray-300 p-2" placeholder="-">
                        </div>
                    </div>
                </div>

                <button type="button" onclick="generateRPM()" class="w-full bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 text-white font-bold py-3 px-4 rounded-lg shadow-lg transform transition active:scale-95 flex justify-center items-center gap-2">
                    <i class="fas fa-wand-magic-sparkles"></i> GENERATE DOKUMEN
                </button>
            </form>
        </div>

        <!-- KOLOM PREVIEW (Kanan) -->
        <div class="w-full xl:w-2/3 flex flex-col gap-4">
            
            <!-- Toolbar Export -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex flex-wrap gap-3 items-center justify-between sticky top-4 z-40">
                <div class="text-gray-700 font-bold flex items-center gap-2">
                    <i class="fas fa-file-lines text-blue-600"></i> Preview Dokumen
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="copyAndOpenDocs()" class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-4 rounded shadow flex items-center gap-2">
                        <i class="fas fa-copy"></i> Salin ke Docs
                    </button>
                    <button onclick="downloadWord()" class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold py-2 px-4 rounded shadow flex items-center gap-2">
                        <i class="fas fa-file-word"></i> Word
                    </button>
                    <button onclick="downloadPDF()" class="bg-red-600 hover:bg-red-700 text-white text-sm font-bold py-2 px-4 rounded shadow flex items-center gap-2">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                </div>
            </div>

            <!-- Area Preview (Simulasi Kertas A4) -->
            <div id="previewContainer" class="flex justify-center bg-gray-200 p-4 md:p-8 rounded-xl overflow-auto min-h-[800px]">
                
                <div id="previewArea" class="hidden">
                    <!-- Konten A4 akan digenerate di sini -->
                </div>

                <!-- State Kosong -->
                <div id="placeholderState" class="flex flex-col items-center justify-center text-gray-400 mt-20">
                    <i class="fas fa-print text-6xl mb-4 text-gray-300"></i>
                    <p class="text-lg font-medium">Dokumen belum dibuat.</p>
                    <p class="text-sm">Silakan isi formulir di sebelah kiri dan klik tombol Generate.</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Data Referensi
        const kelasOptions = {
            'SD': ['Kelas 1', 'Kelas 2', 'Kelas 3', 'Kelas 4', 'Kelas 5', 'Kelas 6'],
            'SMP': ['Kelas 7', 'Kelas 8', 'Kelas 9'],
            'SMA': ['Kelas 10', 'Kelas 11', 'Kelas 12'],
            'SMK': ['Kelas 10', 'Kelas 11', 'Kelas 12']
        };
        const faseMapping = {
            'Kelas 1': 'Fase A', 'Kelas 2': 'Fase A',
            'Kelas 3': 'Fase B', 'Kelas 4': 'Fase B',
            'Kelas 5': 'Fase C', 'Kelas 6': 'Fase C',
            'Kelas 7': 'Fase D', 'Kelas 8': 'Fase D', 'Kelas 9': 'Fase D',
            'Kelas 10': 'Fase E', 'Kelas 11': 'Fase F', 'Kelas 12': 'Fase F'
        };
        const pedagogyOptions = [
            "Inkuiri-Discovery Learning",
            "Project Based Learning (PjBL)",
            "Problem Based Learning (PBL)",
            "Game Based Learning",
            "Station Learning",
            "Teaching Factory (TeFa)"
        ];

        // --- Fungsi UI Input ---
        function updateKelas() {
            const jenjang = document.getElementById('jenjang').value;
            const kelasSelect = document.getElementById('kelas');
            kelasSelect.innerHTML = '<option value="">Pilih Kelas</option>';
            if (jenjang && kelasOptions[jenjang]) {
                kelasOptions[jenjang].forEach(cls => {
                    const opt = document.createElement('option');
                    opt.value = cls;
                    opt.textContent = cls;
                    kelasSelect.appendChild(opt);
                });
            }
            updateFase();
        }
        
        function updateFase() {
            const kelas = document.getElementById('kelas').value;
            document.getElementById('fase').value = (kelas && faseMapping[kelas]) ? faseMapping[kelas] : "";
        }

        function updatePedagogyInputs() {
            const count = document.getElementById('jmlPertemuan').value;
            const container = document.getElementById('pedagogyInputs');
            container.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2';
                div.innerHTML = `
                    <span class="text-xs font-bold text-gray-500 w-8">P${i}:</span>
                    <select id="pedagogy-${i}" class="flex-1 rounded border-gray-300 text-xs p-1">
                        ${pedagogyOptions.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                    </select>
                `;
                container.appendChild(div);
            }
        }
        updatePedagogyInputs();

        // --- Fungsi "AI" Generator Narasi ---
        function getStudentCharacteristics(jenjang) {
            if (jenjang === 'SD') return "Peserta didik berada pada tahap operasional konkret, aktif bergerak, senang bermain, dan belajar melalui pengalaman langsung.";
            if (jenjang === 'SMP') return "Peserta didik berada pada masa transisi remaja, mulai mengembangkan pemikiran abstrak, kritis, dan membutuhkan validasi sosial dalam kelompok.";
            return "Peserta didik mampu berpikir abstrak, logis, idealis, serta mulai merancang masa depan dan kemandirian dalam belajar.";
        }

        function generateCrossDiscipline(mapel) {
            const m = mapel.toLowerCase();
            if (m.includes('matematika')) return "Fisika (Penerapan Rumus), Seni (Pola Geometris)";
            if (m.includes('bahasa')) return "IPS (Konteks Sosial), Sejarah (Literasi)";
            if (m.includes('ipa') || m.includes('fisika')) return "Matematika (Hitungan), Bahasa (Laporan)";
            return "Bahasa Indonesia (Literasi), Pendidikan Karakter";
        }

        function generateActivities(pedagogy, materi, type) {
            if (type === 'intro') return `Guru mengajukan pertanyaan pemantik tentang <strong>${materi}</strong> untuk menggali pengetahuan awal siswa dan mengaitkannya dengan kehidupan sehari-hari (Berkesadaran).`;
            if (type === 'closing') return `Siswa melakukan refleksi terhadap proses belajar hari ini. Guru memberikan apresiasi dan umpan balik konstruktif (Menggembirakan).`;
            
            // Inti
            if (pedagogy.includes("PjBL")) return `Siswa secara berkelompok menyusun rancangan proyek terkait <strong>${materi}</strong>, menyusun jadwal, melaksanakan pembuatan proyek, dan mempresentasikan hasilnya di depan kelas.`;
            if (pedagogy.includes("Problem")) return `Siswa menganalisis studi kasus masalah nyata tentang <strong>${materi}</strong>, melakukan penyelidikan mendalam, dan merumuskan solusi pemecahan masalah.`;
            if (pedagogy.includes("Game")) return `Siswa melakukan aktivitas permainan edukatif yang dirancang untuk menguji pemahaman tentang <strong>${materi}</strong> dalam suasana kompetitif yang menyenangkan.`;
            return `Siswa melakukan eksplorasi konsep <strong>${materi}</strong> melalui diskusi kelompok, studi literatur, dan pengerjaan lembar kerja terstruktur.`;
        }

        function generateAssessment(materi, pedagogy) {
            return {
                awal: `
                    <strong>Pertanyaan Pemantik:</strong>
                    <ol style="margin-left: 15px; margin-top: 5px;">
                        <li>Apa yang terlintas di pikiranmu saat mendengar tentang ${materi}?</li>
                        <li>Pernahkah kamu menemukan penerapan ${materi} dalam kehidupan sehari-hari? Berikan contohnya!</li>
                        <li>Menurutmu, seberapa penting kita mempelajari ${materi}?</li>
                    </ol>`,
                proses: `
                    <strong>Lembar Observasi (${pedagogy}):</strong>
                    <ul style="margin-left: 15px; margin-top: 5px; list-style-type: disc;">
                        <li>Keaktifan siswa dalam diskusi tentang ${materi}.</li>
                        <li>Kemampuan siswa menghubungkan konsep ${materi} dengan masalah nyata.</li>
                        <li>Kerjasama dalam kelompok saat menyelesaikan tantangan belajar.</li>
                    </ul>`,
                akhir: `
                    <strong>Soal Evaluasi (HOTS):</strong>
                    <ol style="margin-left: 15px; margin-top: 5px;">
                        <li>Jelaskan konsep dasar ${materi} menggunakan bahasamu sendiri!</li>
                        <li>Analisislah bagaimana ${materi} dapat mempengaruhi fenomena di lingkungan sekitarmu!</li>
                        <li>Berikan satu contoh studi kasus / masalah yang berkaitan dengan ${materi} dan tawarkan solusinya!</li>
                        <li>Buatlah kesimpulan singkat mengenai poin penting dari ${materi}!</li>
                    </ol>`
            };
        }

        function generateLKPDSteps(pedagogy) {
             if (pedagogy.includes("PjBL")) return `<li>Bentuklah kelompok yang terdiri dari 4-5 orang.</li><li>Tentukan tema proyek yang akan dibuat.</li><li>Susunlah jadwal penyelesaian proyek.</li><li>Lakukan pengerjaan proyek sesuai jadwal.</li><li>Presentasikan hasil karya kalian.</li>`;
             if (pedagogy.includes("Problem")) return `<li>Bacalah studi kasus masalah dengan cermat.</li><li>Identifikasi akar permasalahan yang terjadi.</li><li>Diskusikan solusi yang paling tepat dengan kelompokmu.</li><li>Tuliskan kesimpulan solusi.</li>`;
             return `<li>Bacalah materi ringkasan dengan seksama.</li><li>Jawablah pertanyaan pemantik yang tersedia.</li><li>Diskusikan jawabanmu dengan teman sebangku.</li><li>Simpulkan hasil diskusi.</li>`;
        }

        // --- FUNGSI UTAMA GENERATE ---
        function generateRPM() {
            const form = document.getElementById('rpmForm');
            if (!form.checkValidity()) {
                alert("Mohon lengkapi data yang wajib diisi.");
                return;
            }

            // Ambil Data
            const d = {
                sekolah: document.getElementById('sekolah').value,
                guru: document.getElementById('guru').value,
                nipGuru: document.getElementById('nipGuru').value || "-", 
                kepsek: document.getElementById('kepsek').value,
                nipKepsek: document.getElementById('nipKepsek').value || "-",
                jenjang: document.getElementById('jenjang').value,
                kelas: document.getElementById('kelas').value,
                fase: document.getElementById('fase').value,
                semester: document.getElementById('semester').value,
                tahun: document.getElementById('tahunAjar').value,
                mapel: document.getElementById('mapel').value,
                konsentrasi: document.getElementById('konsentrasi').value || "-",
                materi: document.getElementById('materi').value,
                durasi: document.getElementById('durasi').value,
                jmlPertemuan: parseInt(document.getElementById('jmlPertemuan').value),
                cp: document.getElementById('cp').value,
                tp: document.getElementById('tp').value,
                dimensi: Array.from(document.querySelectorAll('input[name="dimensi"]:checked')).map(cb => cb.value).join(", ") || "Mandiri, Bernalar Kritis"
            };

            // Generate Loops
            let rowsPertemuan = "";
            let pedagogies = [];
            for (let i = 1; i <= d.jmlPertemuan; i++) {
                const ped = document.getElementById(`pedagogy-${i}`).value;
                pedagogies.push(ped);
                rowsPertemuan += `
                <tr>
                    <td colspan="3" style="background-color: #f3f4f6; font-weight: bold; padding: 4px 8px;">Pertemuan Ke-${i} (${ped})</td>
                </tr>
                <tr>
                    <td><strong>Pendahuluan (Memahami)</strong><br/><br/>${generateActivities(ped, d.materi, 'intro')}</td>
                    <td><strong>Inti (Mengaplikasi)</strong><br/><br/>${generateActivities(ped, d.materi, 'core')}</td>
                    <td><strong>Penutup (Refleksi)</strong><br/><br/>${generateActivities(ped, d.materi, 'closing')}</td>
                </tr>`;
            }

            // Generate AI Data
            const ai = {
                siswa: getStudentCharacteristics(d.jenjang),
                lintas: generateCrossDiscipline(d.mapel),
                asesmen: generateAssessment(d.materi, pedagogies[0]),
                lkpd: generateLKPDSteps(pedagogies[0]),
                topik: `Eksplorasi ${d.materi} dalam Kehidupan Nyata`
            };

            const uniquePedagogies = [...new Set(pedagogies)].join(", ");

            // --- TEMPLATE HTML A4 ---
            const docHTML = `
            <div class="a4-page">
                <!-- KOP JUDUL -->
                <div class="main-header">
                    <h1>RENCANA PEMBELAJARAN MENDALAM (RPM)</h1>
                    <h2>${d.sekolah}</h2>
                    <p style="margin: 5px 0 0 0; font-size: 11pt; font-weight: normal;">Tahun Pelajaran ${d.tahun}</p>
                </div>

                <!-- 1. IDENTITAS (VERTIKAL) -->
                <div class="section-title">A. IDENTITAS UMUM</div>
                <table class="doc-table">
                    <tr>
                        <td width="25%"><strong>Nama Sekolah</strong></td>
                        <td width="75%">${d.sekolah}</td>
                    </tr>
                    <tr>
                        <td><strong>Nama Guru</strong></td>
                        <td>${d.guru}</td>
                    </tr>
                    <tr>
                        <td><strong>Mata Pelajaran</strong></td>
                        <td>${d.mapel}</td>
                    </tr>
                    <tr>
                        <td><strong>Fase / Kelas</strong></td>
                        <td>${d.fase} / ${d.kelas}</td>
                    </tr>
                    <tr>
                        <td><strong>Materi Pokok</strong></td>
                        <td>${d.materi}</td>
                    </tr>
                    <tr>
                        <td><strong>Alokasi Waktu</strong></td>
                        <td>${d.durasi}</td>
                    </tr>
                    <tr>
                        <td><strong>Semester</strong></td>
                        <td>${d.semester}</td>
                    </tr>
                    <tr>
                        <td><strong>Tahun Pelajaran</strong></td>
                        <td>${d.tahun}</td>
                    </tr>
                    <tr>
                        <td><strong>Konsentrasi Keahlian</strong></td>
                        <td>${d.konsentrasi}</td>
                    </tr>
                </table>

                <!-- 2. KOMPONEN INTI -->
                <div class="section-title">B. KOMPONEN INTI</div>
                <table class="doc-table">
                    <tr>
                        <td width="30%"><strong>Capaian Pembelajaran (CP)</strong></td>
                        <td>${d.cp}</td>
                    </tr>
                    <tr>
                        <td><strong>Tujuan Pembelajaran (TP)</strong></td>
                        <td>${d.tp}</td>
                    </tr>
                     <tr>
                        <td><strong>Profil Pelajar Pancasila</strong></td>
                        <td>${d.dimensi}</td>
                    </tr>
                    <tr>
                        <td><strong>Karakteristik Siswa</strong></td>
                        <td>${ai.siswa}</td>
                    </tr>
                     <tr>
                        <td><strong>Topik Pembelajaran</strong></td>
                        <td>${ai.topik}</td>
                    </tr>
                    <tr>
                        <td><strong>Model Pembelajaran</strong></td>
                        <td>${uniquePedagogies}</td>
                    </tr>
                </table>

                <!-- 3. KEGIATAN PEMBELAJARAN -->
                <div class="section-title" style="margin-top: 10px;">C. KEGIATAN PEMBELAJARAN (Deep Learning)</div>
                <table class="doc-table">
                    ${rowsPertemuan}
                </table>

                <!-- 4. ASESMEN -->
                <div class="section-title">D. ASESMEN PEMBELAJARAN</div>
                <table class="doc-table">
                    <tr>
                        <th width="33%">Awal (Diagnostik)</th>
                        <th width="33%">Proses (Formatif)</th>
                        <th width="33%">Akhir (Sumatif)</th>
                    </tr>
                    <tr>
                        <td style="vertical-align: top;">${ai.asesmen.awal}</td>
                        <td style="vertical-align: top;">${ai.asesmen.proses}</td>
                        <td style="vertical-align: top;">${ai.asesmen.akhir}</td>
                    </tr>
                </table>

                <!-- TANDA TANGAN (Jarak 3-4 Enter) -->
                <table class="signature-table">
                    <tr>
                        <td width="40%">
                            Mengetahui,<br>
                            Kepala Sekolah
                            <div class="ttd-space"></div>
                            <strong><u>${d.kepsek}</u></strong><br>
                            NIP. ${d.nipKepsek}
                        </td>
                        <td width="20%"></td>
                        <td width="40%">
                            Guru Mata Pelajaran
                            <div class="ttd-space"></div>
                            <strong><u>${d.guru}</u></strong><br>
                            NIP. ${d.nipGuru}
                        </td>
                    </tr>
                </table>

                <!-- PAGE BREAK UNTUK LAMPIRAN -->
                <div style="page-break-before: always;"></div>

                <!-- LAMPIRAN -->
                <div class="main-header" style="border: none; margin-top: 20px;">
                    <h2>LAMPIRAN PEMBELAJARAN</h2>
                </div>

                <div class="section-title">E. LEMBAR KERJA PESERTA DIDIK (LKPD)</div>
                <table class="doc-table" style="margin-top: 10px;">
                    <tr>
                        <td width="20%"><strong>Mata Pelajaran</strong></td><td>${d.mapel}</td>
                        <td width="20%"><strong>Kelas</strong></td><td>${d.kelas}</td>
                    </tr>
                    <tr>
                        <td><strong>Materi</strong></td><td colspan="3">${d.materi}</td>
                    </tr>
                    <tr>
                        <td colspan="4" style="background-color: #f3f4f6; text-align: center; font-weight: bold;">LANGKAH KERJA</td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <ol style="margin-left: 20px; padding: 10px 0;">
                                ${ai.lkpd}
                            </ol>
                            <div style="border: 2px dashed #ccc; height: 150px; margin: 10px; display: flex; align-items: center; justify-content: center; color: #999;">
                                [Area Pengerjaan / Jawaban Siswa]
                            </div>
                        </td>
                    </tr>
                </table>

                <div class="section-title">F. BAHAN BACAAN & REFERENSI</div>
                <div style="border: 1px solid black; padding: 15px; margin-top: 10px; font-size: 11pt;">
                    <p style="text-align: justify; margin-bottom: 10px;">
                        <strong>Ringkasan Materi:</strong><br>
                        ${d.materi} adalah topik fundamental yang mencakup pemahaman konsep dan penerapan praktis. Siswa diharapkan mampu menghubungkan materi ini dengan konteks lintas disiplin ilmu seperti ${ai.lintas}.
                    </p>
                    <p><strong>Glosarium:</strong></p>
                    <ul style="margin-left: 20px; list-style-type: disc;">
                        <li><strong>Deep Learning:</strong> Pembelajaran mendalam yang bermakna.</li>
                        <li><strong>${d.materi}:</strong> Konsep inti pembelajaran ini.</li>
                    </ul>
                    <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dotted #ccc;">
                        <strong>Tautan Referensi Digital:</strong><br>
                        <a href="https://www.google.com/search?q=Materi+${encodeURIComponent(d.materi)}+${d.jenjang}" target="_blank" class="doc-link">Cari Materi di Google</a> | 
                        <a href="https://www.youtube.com/results?search_query=Pembelajaran+${encodeURIComponent(d.materi)}" target="_blank" class="doc-link">Video Pembelajaran YouTube</a>
                    </div>
                </div>
            </div>
            `;

            const area = document.getElementById('previewArea');
            area.innerHTML = docHTML;
            area.classList.remove('hidden');
            document.getElementById('placeholderState').classList.add('hidden');
        }

        // --- EXPORT FUNCTIONS ---
        function downloadPDF() {
            const element = document.getElementById('previewArea');
            if(element.classList.contains('hidden')) { alert("Buat dokumen dulu!"); return; }
            
            const opt = {
                margin: 0,
                filename: `RPM_${document.getElementById('materi').value.substring(0,10)}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function downloadWord() {
            const element = document.getElementById('previewArea');
            if(element.classList.contains('hidden')) { alert("Buat dokumen dulu!"); return; }

            const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
                "xmlns:w='urn:schemas-microsoft-com:office:word' "+
                "xmlns='http://www.w3.org/TR/REC-html40'>"+
                "<head><meta charset='utf-8'><title>Export DOC</title></head><body>";
            const footer = "</body></html>";
            
            // CSS Inline untuk Word
            // Note: Word sulit merender External CSS, jadi kita pakai style di element HTML langsung (sudah ada di template string)
            // Tambahkan CSS khusus untuk memastikan tabel border muncul di Word
            const styles = `
                <style>
                    body { font-family: 'Times New Roman', serif; font-size: 12pt; }
                    table { border-collapse: collapse; width: 100%; margin-bottom: 10px; }
                    td, th { border: 1px solid black; padding: 5px; }
                    .no-border td { border: none; }
                </style>
            `;
            
            const sourceHTML = header + styles + element.innerHTML + footer;
            const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
            const fileDownload = document.createElement("a");
            document.body.appendChild(fileDownload);
            fileDownload.href = source;
            fileDownload.download = `RPM_${document.getElementById('materi').value.substring(0,10)}.doc`;
            fileDownload.click();
            document.body.removeChild(fileDownload);
        }

        async function copyAndOpenDocs() {
            const element = document.getElementById('previewArea');
            if(element.classList.contains('hidden')) { alert("Buat dokumen dulu!"); return; }
            
            const blobHtml = new Blob([element.innerHTML], { type: 'text/html' });
            const blobText = new Blob([element.innerText], { type: 'text/plain' });
            await navigator.clipboard.write([new ClipboardItem({'text/html': blobHtml, 'text/plain': blobText})]);
            if(confirm("Tersalin! Buka Google Docs?")) window.open('https://docs.new', '_blank');
        }
    </script>
</body>
</html>